/*
 * (c) LudvÃ­k Prokopec
 * License: MIT 
 */
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.ReactiveHTML=b())})(this,function(){"use strict";function a(a){return"object"==typeof a&&null!==a}function b(a){let b={},c={};for(const[d,e]of Object.entries(a))d.startsWith("on")&&(b[d.replace("on","")]=e,delete a[d]),"style"===d&&(c=e,delete a[d]);return{basic:a,events:b,styles:c}}function c(a,c,...d){let e=null;return null!==c&&void 0!==c[":key"]&&(e=c[":key"],delete c[":key"]),a.prototype instanceof r?{type:a,props:c,_key:e}:{type:a,attrs:c?b(c):{events:{},styles:{},basic:{}},children:d,_key:e}}function d(a){const b=new a.type(a.props);return b.vnode=b.Element(b.props,b.states),b}function e(a){const b=document.createElement(a.type);for(const[c,d]of Object.entries(a.attrs.basic))b.setAttribute(c,d);for(const[c,d]of Object.entries(a.attrs.events))b.addEventListener(c,d);for(const[c,d]of Object.entries(a.attrs.styles))b.style[c]=d;return a.children.forEach(a=>{if(Array.isArray(a)){const c=a.map(a=>f(a));c.forEach(a=>b.appendChild(a))}else{const c=f(a);b.appendChild(c)}}),b}function f(b){if(!a(b))return document.createTextNode(b);if(Array.isArray(b))return b.map(a=>f(a));if(b.type.prototype instanceof r){const a=d(b);return a.realDOM=f(a.vnode),a.onComponentRender(a.realDOM),Object.assign(b,a),a.onComponentWillMount(b.realDOM),b.realDOM}return e(b)}function g(a,b,c){return c?b.replaceWith(a):b.appendChild(a),a}function h(b,c,d,e){let f,g;return(b.getSnapshotBeforeUpdate||b.getSnapshotAfterUpdate&&e)&&([f,g]=[cloneObjectWithoutReference(b.props),cloneObjectWithoutReference(b.states)]),b.states&&a(d)&&Object.assign(b.states,d),b.props&&a(c)&&Object.assign(b.props,c),b.getSnapshotBeforeUpdate&&b.getSnapshotBeforeUpdate(f,g),[f,g]}function i(a,b,c,d){if(!1===b&&!1===a.componentShouldUpdate(c,d))return h(a,c,d,!1),a.onComponentCancelUpdate(),a;const[e,f]=h(a,c,d,!0);a.onComponentWillUpdate();const g=j(a.Element(a.props,a.states),a.vnode,b);if(a.realDOM){const b=q(a.vnode,g);a.realDOM=b(a.realDOM)}return a.vnode=g,a.onComponentUpdate(),a.getSnapshotAfterUpdate&&a.getSnapshotAfterUpdate(e,f),a}function j(b,c,d){return a(b)?isArray(b)?b.map((a,b)=>j(a,c[b],d)):b.type.prototype instanceof componentClass?c?i(c.__component__,d,b.props,c.states):b:void 0===c?b:(b.children=b.children.map((a,b)=>j(a,c.children[b],d)),b):b}function j(b,c,d){return a(b)?Array.isArray(b)?b.map((a,b)=>j(a,c[b],d)):b.type.prototype instanceof r?c?i(c.__component__,d,b.props,c.states):b:void 0===c?b:(b.children=b.children.map((a,b)=>j(a,c.children[b],d)),b):b}function k(a,b,c=!0,d=!0){const e=new MutationObserver((e,f)=>{e.forEach(e=>{Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(d&&e.matches(a)||e.localName===a)&&(b(e),c&&f.disconnect())})})});return e.observe(document.documentElement,{childList:!0,subtree:!0}),e}function l(a,b){const c=[];for(let d=0;d<Math.min(a.length,b.length);d++)c.push([a[d],b[d]]);return c}function m(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return a.style[d]=e,a});for(const d in a)d in b||c.push(function(a){return a.style[d]=null,a});return function(a){for(const b of c)b(a)}}function n(a,b){const c=[],d=[];a.forEach((a,e)=>{Array.isArray(a)?d.push(p(a,b[e])):c.push(q(a,b[e]))});for(const c of b.slice(a.length))d.push(function(a){return a.appendChild(f(c)),a});return function(a){for(const[b,d]of l(c,a.childNodes))b(d);for(const b of d)b(a);return a}}function o(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return"value"===d&&(a.value=e),a.setAttribute(d,e),a});for(const d in a)d in b||c.push(function(a){return a.removeAttribute(d),a});return function(a){for(const b of c)b(a)}}function p(a,b){const c=[];for(const d of a)c.push(q(d,b.find(a=>a._key===d._key)));const d=[];for(const c of b.slice(a.length))d.push(function(a){return a.appendChild(f(c)),a});return function(a){for(const[b,d]of l(c,a.childNodes))b(d);for(const b of d)b(a);return a}}function q(b,c){if(a(b)&&b.__component__)return a=>a;if(void 0===c)return function(a){a.remove()};if(!a(b)||!a(c))return b===c?()=>void 0:function(a){const b=f(c);return a.replaceWith(b),b};if(b.type!==c.type)return function(a){const b=f(c);return a.replaceWith(b),b};const d=o(b.attrs.basic,c.attrs.basic),e=m(b.attrs.styles,c.attrs.styles),g=n(b.children,c.children);return function(a){return d(a),g(a),e(a),a}}class r{constructor(a){return this.props=a,this.__component__=this,this.onComponentCreate(),this}Element(){throw Error("You have to specify Element method in your Component")}onComponentCreate(){}onComponentUpdate(){}onComponentRender(){}onComponentCancelUpdate(){}onComponentWillUpdate(){}onComponentWillRender(){}onComponentWillMount(){}componentShouldUpdate(){return!0}setState(a){const b=cloneObjectWithoutReference(this.states);return a(b),i(this,!1,this.props,b)}forceComponentUpdate(a=!1){return i(this,a,this.props,this.states)}}return{Component:r,render:function(a,b){return g(f(a),b)},elementReady:function(a,b){k(a,b)},createElement:c,createFactory:function(a){return function(b={}){return c(a,b)}}}});
