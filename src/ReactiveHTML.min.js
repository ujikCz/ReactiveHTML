/*
  (c) LudvÃ­k Prokopec
  License: MIT
*/
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.ReactiveHTML=b()})(this,function(){"use strict";function a(a){return"object"==typeof a&&null!==a}function b(a){let b={},c={};for(const[d,e]of Object.entries(a))d.startsWith("on")&&(b[d.replace("on","")]=e,delete a[d]),"style"===d&&(c=e,delete a[d]);return{attrs:a,events:b,styles:c}}function c(a){return a.reduce(function(a,b){return a.concat(Array.isArray(b)?c(b):b)},[])}function d(b){if(!a(b)||!Object.getPrototypeOf(b)||!Object.getPrototypeOf(Object.getPrototypeOf(b)))return b;let c=Object.getPrototypeOf(Object.getPrototypeOf(b));return"Component"===c.constructor.name&&Object.getPrototypeOf(c).isPrototypeOf(m)?(b.Vnode.realDOM=null,b.Vnode):b}function e(a){return a.map(a=>d(a))}function f(a){const b=Object.getPrototypeOf(a),c=b.Element.bind(a)(a.props);if(a.Vnode.realDOM){const b=p(a.Vnode,c);c.realDOM=b(a.Vnode.realDOM)}Object.assign(a.Vnode,c),i(b.onComponentUpdate,a)}function g(a,b,c=!0,d=!0){const e=new MutationObserver((e,f)=>{e.forEach(e=>{Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(d&&e.matches(a)||e.localName===a)&&(b(e),c&&f.disconnect())})})});e.observe(document.documentElement,{childList:!0,subtree:!0})}function h(a,b,c){return c?b.replaceWith(a):b.appendChild(a),a}function i(a,b,...c){return void 0===a?void 0:a.bind(b)(...c)}function j(b){return a(b)?function(a){const b=document.createElement(a.tagName);for(const[c,d]of Object.entries(a.attrs))b.setAttribute(c,d);for(const[c,d]of Object.entries(a.events))b.addEventListener(c,d);for(const[c,d]of Object.entries(a.styles))b.style[c]=d;return a.children.forEach(a=>{const c=j(a);b.appendChild(c)}),null===a.realDOM&&(a.realDOM=b),b}(b):document.createTextNode(b)}function k(a,b){const c=[];for(let d=0;d<Math.min(a.length,b.length);d++)c.push([a[d],b[d]]);return c}function l(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return"value"===d&&(a.value=e),a.setAttribute(d,e),a});for(const d in a)d in b||c.push(function(a){return a.removeAttribute(d),a});return function(a){for(const b of c)b(a)}}const m={Component:class{constructor(b={}){const c=Object.getPrototypeOf(this),d={classLink:this,get(b,c){return a(b[c])&&("Object"===b[c].constructor.name||Array.isArray(b[c]))?new Proxy(b[c],d):b[c]},set(a,b,c){return a[b]=c,f(this.classLink),!0}};return this.props=new Proxy(b,d),this.Vnode=c.Element.bind(this)(this.props),i(c.onComponentCreate,this),this}},Hook:class{constructor(a){this.value=a,this.effect=[];const b=function(a){return this.value=a,this.effect.forEach(a=>{f(a)}),this}.bind(this);return[this,b]}hookOn(...a){return this.effect.push(...a),a.forEach(a=>{i(Object.getPrototypeOf(a).onComponentHook,a,this)}),this}unHook(...a){return a.forEach(a=>{this.effect.splice(this.effect.indexOf(a)),i(Object.getPrototypeOf(a).onComponentUnHook,a,this)}),this}isUnHooked(a){return!this.effect.find(b=>b===a)}},Dispatcher:class{constructor(a,b){g(a,a=>{const c={};return Array.from(a.attributes).forEach(a=>{c[a.nodeName]=new Function(`"use strict"; return(${a.nodeValue})`)()}),m.Render(new b(c),a,!0)},!1,!1)}},RenderConstants:{REPLACE_WITH_COMPONENT:!0,APPEND_COMPONENT:!1},Render:function(a,b,c=!1){const e=j(d(a)),f=Object.getPrototypeOf(a);return i(f.onComponentRender,a),i(f.onComponentMount,a),h(e,b,c)},Await:function(a,b){g(a,b)},CreateElement:function(a,d,...f){null===d&&(d={});const g=b(d);return{tagName:a,attrs:g.attrs,children:e(c(f)),events:g.events,styles:g.styles}}},n=(a,b)=>{const c=[];a.forEach((a,d)=>{c.push(p(a,b[d]))});const d=[];for(const c of b.slice(a.length))d.push(function(a){return a.appendChild(j(c)),a});return function(a){for(const[b,d]of k(c,a.childNodes))b(d);for(const b of d)b(a);return a}},o=(a,b)=>{const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return a.style[d]=e,a});for(const d in a)d in b||c.push(function(a){return a.style[d]=null,a});return function(a){for(const b of c)b(a)}},p=(b,c)=>{if(c===void 0)return function(a){a.remove()};if(!a(b)||!a(c))return b===c?()=>void 0:function(a){const b=j(c);return a.replaceWith(b),b};if(b.tagName!==c.tagName)return function(a){const b=j(c);return a.replaceWith(b),b};const d=l(b.attrs,c.attrs),e=n(b.children,c.children),f=o(b.styles,c.styles);return function(a){return d(a),e(a),f(a),a}};return m});
