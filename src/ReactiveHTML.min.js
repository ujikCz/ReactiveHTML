/** 
 *  (c) LudvÃ­k Prokopec
 *  License: MIT 
 */
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.ReactiveHTML=b())})(this,function(){"use strict";function a(a){return"object"==typeof a&&null!==a}function b(a){return"function"==typeof a}function c(a){return Array.isArray(a)}function d(a,b=null,...c){let d=null;return null!==b&&void 0!==b._key&&(d=b._key,Reflect.deleteProperty(b,"_key")),a.ReactiveHTMLComponent?{type:a,props:b,_key:d}:{type:a,attrs:b,children:c,_key:d}}function e(a){const b=new a.type(a.props);return b.vnode=b.Element(b.props,b.states),Object.setPrototypeOf(a,Object.getPrototypeOf(b)),b.onComponentWillRender(),Object.assign(a,b),a}function f(a,b){if(a._memo)return()=>void 0;if(!1===a.shouldComponentUpdate())return a.onComponentCancelUpdate(),()=>void 0;a.getSnapshotBeforeUpdate(),a.props=b.props,a.onComponentWillUpdate();const c=a.Element(),d=o(a.vnode,c);return a.vnode=c,a.onComponentUpdate(),d}function g(a,b){return o(a.vnode||a,b.vnode||b)}function h(a){return a()}function i(b,d){if(!a(b))return d(document.createTextNode(b));if(c(b))return d(b.map(a=>j(a,a=>a)));const e=document.createElement(b.type);for(const c in b.attrs)if(c.startsWith("on")){e.addEventListener(c.replace("on",""),b.attrs[c]);continue}else if(a(b.attrs[c])){Object.assign(e[c],b.attrs[c]);continue}else e[c]=b.attrs[c];if(b.children.length)for(let a=0,d=b.children;a<d.length;a++)if(c(d[a]))for(let b=0;b<d[a].length;b++)j(d[a][b],function(a){e.appendChild(a)});else j(d[a],function(a){e.appendChild(a)});d(e)}function j(b,d){a(b)&&!c(b)&&b.type.ReactiveHTMLComponent?(b=e(b),h(()=>j(b.vnode,function(a){b.onComponentRender(a),b.onComponentWillMount(a),b.ref.realDOM=a,b.onComponentMount(a),d(a)}))):h(()=>i(b,d))}function k(a,b){const c=[];for(let d=0;d<Math.min(a.length,b.length);d++)c.push([a[d],b[d]]);return c}function m(a,b){const d=[],e=[];for(let g=0,f=a.length;g<f;g++)c(a[g])?e.push(m(a[g],b[g])):null===a[g]._key?d.push(o(a[g],b[g])):d.push(o(a[g],b.find(b=>b._key===a[g]._key)));for(let d=0,f=b.length;d<f;d++)c(b[d])||(null===b[d]._key?e.push(function(a){return j(b[d],function(b){a.appendChild(b)})}):!a.some(a=>a._key===b[d]._key)&&e.push(function(a){return j(b[d],function(c){return d===b.length-1?a.appendChild(c):a.insertBefore(c,a.childNodes[d])})}));return function(a){a&&k(d,a.childNodes).forEach(([a,b])=>{a(b)});for(let b=0;b<e.length;b++)e[b](a);return a}}function n(b,c){const d=[];for(const e in c)if(e.startsWith("on"))continue;else if(a(c[e])){d.push(function(a){return Object.assign(a[e],c[e]),a});continue}else d.push(function(a){return a[e]=c[e],a});for(const a in b)a in c||d.push(function(b){return b.removeAttribute(a),b});return function(a){for(let b=0;b<d.length;b++)d[b](a)}}function o(c,d){const e=a(c),h=a(d),i=!!e&&b(c.type),k=!!h&&b(d.type);return void 0===d?function(a){return i&&c.onComponentWillUnMount(),a.remove(),void(i&&c.onComponentUnMount())}:i&&k?c.type===d.type?function(a,b){const e=f(c,d,c.states);d.vnode=c.vnode,e(a,a=>b(a))}:function(a,b){j(d,function(){c.onComponentWillUnMount();const e=g(c,d);e(a,a=>b(a)),c.onComponentUnMount()})}:i&&!k?function(a){const b=g(c,d);return c.onComponentWillUnMount(),b(a),c.onComponentUnMount(),a}:!i&&k?function(a,b){j(d,function(){const e=g(c,d);e(a),b(a)})}:e||h?!e&&h||e&&!h?function(a){j(d,function(b){a.replaceWith(b)})}:c.type===d.type?function(a){return c._memo?a:(null!==c.attrs&&0<Object.keys(c.attrs).length+Object.keys(d.attrs).length&&n(c.attrs,d.attrs)(a),0<c.children.length+d.children.length&&m(c.children,d.children)(a),a)}:function(a){return j(d,function(b){a.replaceWith(b)})}:c===d?()=>void 0:function(a){a.nodeValue=d}}class p{constructor(a){return this.props=a,this.ref={},this}Element(){throw Error("You have to specify Element method in your Component")}setState(a){if(b(a)){a.bind(this)();const b=f(this,this);return b(this.ref.realDOM,a=>this.ref.realDOM=a)}throw TypeError(`setState method expecting 1 parameter as Function, you given ${typeof a}`)}onComponentUpdate(){}onComponentWillUpdate(){}onComponentRender(){}onComponentWillRender(){}onComponentMount(){}onComponentWillMount(){}onComponentUnMount(){}onComponentWillUnMount(){}shouldComponentUpdate(){return!0}getSnapshotBeforeUpdate(){}onComponentCancelUpdate(){}}p.ReactiveHTMLComponent=!0;return{Component:p,render:function(a,b){return j(a,function(a){return b.appendChild(a),a})},createElement:d,createFactory:function(a){if(!a.ReactiveHTMLComponent)throw TypeError("createFactory expecting first parameter as Component class");return function(b={}){return d(a,b)}},memo:function(a){return a._memo=!0,a}}});