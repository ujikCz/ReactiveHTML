/** 
 *  (c) LudvÃ­k Prokopec
 *  License: MIT 
 */
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.ReactiveHTML=b())})(this,function(){"use strict";function a(a){return"object"==typeof a&&null!==a}function b(a){return Array.isArray(a)}function c(d){if(!a(d))return d;const e=b(d)?[]:{};for(const a in d)e[a]=c(d[a]);return e}function d(a){const b=new a.type(a.props);return b.vnode=b.Element(b.props,b.states),b}function e(a){const c=document.createElement(a.type);if(null!==a.attrs){for(const[b,d]of Object.entries(a.attrs.basic))c.setAttribute(b,d);for(const[b,d]of Object.entries(a.attrs.events))c.addEventListener(b,d);for(const[b,d]of Object.entries(a.attrs.styles))c.style[b]=d}return a.children.length&&a.children.forEach(a=>{if(b(a)){const b=a.map(a=>f(a));b.forEach(a=>c.appendChild(a))}else{const b=f(a);c.appendChild(b)}}),c}function f(c){if(!a(c))return document.createTextNode(c);if(b(c))return c.map(a=>f(a));if(c.type.prototype instanceof r){const a=d(c);return a.realDOM=f(a.vnode),a.onComponentRender(a.realDOM),Object.assign(c,a),a.onComponentWillMount(c.realDOM),c.realDOM}return e(c)}function g(a,b){const c=[];for(let d=0;d<Math.min(a.length,b.length);d++)c.push([a[d],b[d]]);return c}function h(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return a.style[d]=e,a});for(const d in a)d in b||c.push(function(a){return a.style[d]=null,a});return function(a){for(const b of c)b(a)}}function i(a,c){const d=[],e=[];a.forEach((a,f)=>{b(a)?e.push(k(a,c[f])):d.push(l(a,c[f]))});for(const b of c.slice(a.length))e.push(function(a){return a.appendChild(f(b)),a});return function(a){for(const[b,c]of g(d,a.childNodes))b(c);for(const b of e)b(a);return a}}function j(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return"value"===d&&(a.value=e),a.setAttribute(d,e),a});for(const d in a)d in b||c.push(function(a){return a.removeAttribute(d),a});return function(a){for(const b of c)b(a)}}function k(a,b){const c=[];for(const d of a)c.push(l(d,b.find(a=>a._key===d._key)));const d=[];for(const c of b.slice(a.length))d.push(function(a){return a.appendChild(f(c)),a});return function(a){for(const[b,d]of g(c,a.childNodes))b(d);for(const b of d)b(a);return a}}function l(b,c){if(a(b)&&b.__component__&&a(c)&&c.__component__)return a=>a;if(void 0===c)return function(a){a.remove()};if(!a(b)&&!a(c))return b===c?()=>void 0:function(a){a.nodeValue=c};if(!a(b)||!a(c))return b===c?()=>void 0:function(a){const b=f(c);return a.replaceWith(b),b};if(b.type!==c.type)return function(a){const b=f(c);return a.replaceWith(b),b};let d,e,g;return null!==b.attrs&&(0!==Object.keys(b.attrs.basic).length+Object.keys(c.attrs.basic).length&&(d=j(b.attrs.basic,c.attrs.basic)),0!==Object.keys(b.attrs.styles).length+Object.keys(c.attrs.styles).length&&(e=h(b.attrs.styles,c.attrs.styles))),0!==b.children.length+c.children.length&&(g=i(b.children,c.children)),function(a){return d&&d(a),e&&e(a),g&&g(a),a}}function m(b,d,e,f){let g,h;return b.getSnapshotBeforeUpdate&&f&&([g,h]=[c(b.props),c(b.states)]),statesNotUpdatedYet&&b.states&&a(e)&&Object.assign(b.states,e),b.props&&a(d)&&Object.assign(b.props,d),void((g||h)&&b.getSnapshotBeforeUpdate(g,h))}function n(a,b=null,...c){let d=null;return(null!==b&&void 0!==b[":key"]&&(d=b[":key"],delete b[":key"]),a.prototype instanceof r)?{type:a,props:b,_key:d}:(null!==b&&(b=o(b)),{type:a,attrs:b,children:c,_key:d})}function o(a){let b={},c={};for(const[d,e]of Object.entries(a))d.startsWith("on")&&(b[d.replace("on","")]=e,delete a[d]),"style"===d&&(c=e,delete a[d]);return{basic:a,events:b,styles:c}}function p(c,d,e){return a(c)?b(c)?c.map((a,b)=>p(a,d[b],e)):c.type.prototype instanceof r?d.__component__?q(d.__component__,e,c.props,d.states):c:void 0===d?c:d.__component__&&!(c.type.prototype instanceof r)?(d.__component__.onComponentWillUnMount(d.__component__.realDOM),d.__component__.realDOM=void 0,d.__component__.onComponentUnMount(),c):(c.children=c.children.map((a,b)=>p(a,d.children[b],e)),c):c}function q(a,b,c,d,e,f){if(!1===b&&a.componentShouldUpdate&&!1===a.componentShouldUpdate(c,d))return m(a,c,d,!1),a.onComponentCancelUpdate(),a;(a.getSnapshotBeforeUpdate||e||f)&&m(a,c,d,!0),a.onComponentWillUpdate();const g=p(a.Element(a.props,a.states),a.vnode,b);if(a.realDOM){const b=l(a.vnode,g);a.realDOM=b(a.realDOM)}return a.vnode=g,a.onComponentUpdate(),a}class r{constructor(a){return this.props=a,this.__component__=this,this.onComponentCreate(),this}Element(){throw new Error("You have to specify Element method in your Component")}onComponentCreate(){}onComponentUpdate(){}onComponentRender(){}onComponentCancelUpdate(){}onComponentUnMount(){}onComponentWillUpdate(){}onComponentWillRender(){}onComponentWillMount(){}onComponentWillUnMount(){}setState(a){if("function"!=typeof a)throw new Error("setState, first parameter must be a function with one parameter that represent the states");let b;return(this.componentShouldUpdate||this.getSnapshotBeforeUpdate)&&(b=c(this.states)),a(b||this.states),q(this,!1,this.props,b||this.states,!1,void 0!==b)}forceComponentUpdate(a=!1){return q(this,a,this.props,this.states)}}return{Component:r,render:function(a,b){return b.appendChild(f(a))},elementReady:function(a,b,c=!0){const d=new MutationObserver((d,e)=>{d.forEach(d=>{Array.from(d.addedNodes).forEach(d=>{d.nodeType===Node.ELEMENT_NODE&&d.matches(a)&&(b(d),c&&e.disconnect())})})});return d.observe(document.documentElement,{childList:!0,subtree:!0}),d},createElement:n,createFactory:function(a){return function(b={}){return n(a,b)}}}});