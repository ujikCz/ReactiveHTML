/*
 * (c) LudvÃ­k Prokopec
 * License: MIT 
 */
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.ReactiveHTML=b())})(this,function(){"use strict";function a(a){return"object"==typeof a&&null!==a}function b(a){let b={},c={};for(const[d,e]of Object.entries(a))d.startsWith("on")&&(b[d.replace("on","")]=e,delete a[d]),"style"===d&&(c=e,delete a[d]);return{basic:a,events:b,styles:c}}function c(a,c,...d){let e=null;return null!==c&&void 0!==c[":key"]&&(e=c[":key"],delete c[":key"]),a.prototype instanceof r?{type:a,props:c,_key:e}:{type:a,attrs:c?b(c):{events:{},styles:{},basic:{}},children:d,_key:e}}function d(a){const b=new a.type(a.props);return b.vnode=b.Element(b.props,b.states),b}function e(a){const b=document.createElement(a.type);for(const[c,d]of Object.entries(a.attrs.basic))b.setAttribute(c,d);for(const[c,d]of Object.entries(a.attrs.events))b.addEventListener(c,d);for(const[c,d]of Object.entries(a.attrs.styles))b.style[c]=d;return a.children.forEach(a=>{if(Array.isArray(a)){const c=a.map(a=>f(a));c.forEach(a=>b.appendChild(a))}else{const c=f(a);b.appendChild(c)}}),b}function f(b){if(!a(b))return document.createTextNode(b);if(Array.isArray(b))return b.map(a=>f(a));if(b.type.prototype instanceof r){const a=d(b);return a.realDOM=f(a.vnode),a.onComponentRender(a.realDOM),Object.assign(b,a),a.onComponentWillMount(b.realDOM),b.realDOM}return e(b)}function g(a){return{get(a,b){return a[b]},set(b,c,d){if(b[c]===d)return!0;const e=Object.assign({},a.states);return e[c]=d,i(a,!1,a.props,e,b,c,d),!0}}}function h(a,b,c){return c?b.replaceWith(a):b.appendChild(a),a}function i(a,b,c,d,e,f,g){function h(){d&&e&&(e[f]=g),a.props&&Object.assign(a.props,c)}if(!1===b&&!1===a.componentShouldUpdate(c,d))return h(),a.onComponentCancelUpdate(),a;h(),a.onComponentWillUpdate();const i=j(a.Element(a.props,a.states),a.vnode,b);if(a.realDOM){const b=q(a.vnode,i);a.realDOM=b(a.realDOM)}return a.vnode=i,a.onComponentUpdate(),a}function j(b,c,d){return a(b)?Array.isArray(b)?b.map((a,b)=>j(a,c[b],d)):b.type.prototype instanceof r?c?i(c.__component__,d,b.props,c.states):b:void 0===c?b:(b.children=b.children.map((a,b)=>j(a,c.children[b],d)),b):b}function k(a,b,c=!0,d=!0){const e=new MutationObserver((e,f)=>{e.forEach(e=>{Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(d&&e.matches(a)||e.localName===a)&&(b(e),c&&f.disconnect())})})});return e.observe(document.documentElement,{childList:!0,subtree:!0}),e}function l(a,b){const c=[];for(let d=0;d<Math.min(a.length,b.length);d++)c.push([a[d],b[d]]);return c}function m(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return a.style[d]=e,a});for(const d in a)d in b||c.push(function(a){return a.style[d]=null,a});return function(a){for(const b of c)b(a)}}function n(a,b){const c=[],d=[];a.forEach((a,e)=>{Array.isArray(a)?d.push(p(a,b[e])):c.push(q(a,b[e]))});for(const c of b.slice(a.length))d.push(function(a){return a.appendChild(f(c)),a});return function(a){for(const[b,d]of l(c,a.childNodes))b(d);for(const b of d)b(a);return a}}function o(a,b){const c=[];for(const[d,e]of Object.entries(b))e!==a[d]&&c.push(function(a){return"value"===d&&(a.value=e),a.setAttribute(d,e),a});for(const d in a)d in b||c.push(function(a){return a.removeAttribute(d),a});return function(a){for(const b of c)b(a)}}function p(a,b){const c=[];a.forEach((a,d)=>Array.isArray(a)?p(a,b[d]):void c.push(q(a,b.find(b=>b._key===a._key))));const d=[];for(const c of b.slice(a.length))d.push(function(a){return a.appendChild(f(c)),a});return function(a){for(const[b,d]of l(c,a.childNodes))b(d);for(const b of d)b(a);return a}}function q(b,c){if(c===void 0)return function(a){a.remove()};if(!a(b)||!a(c))return b===c?()=>void 0:function(a){const b=f(c);return a.replaceWith(b),b};if(b.__component__||c.__component__)return q(b.vnode||b,c.vnode||newNode);if(b.type!==c.type)return function(a){const b=f(c);return a.replaceWith(b),b};const d=o(b.attrs.basic,c.attrs.basic),e=m(b.attrs.styles,c.attrs.styles),g=n(b.children,c.children);return function(a){return d(a),g(a),e(a),a}}class r{constructor(a={}){return this.props=a,this.__component__=this,this}Element(){throw Error("You have to specify Element method in your Component")}onComponentCreate(){}onComponentUpdate(){}onComponentRender(){}onComponentCancelUpdate(){}onComponentWillUpdate(){}onComponentWillRender(){}onComponentWillMount(){}componentShouldUpdate(){return!0}reactive(b){return a(b)&&("Object"===b.constructor.name||Array.isArray(b))?new Proxy(b,g(this)):(console.warn("To make value reactive, value have to be object or array."),b)}forceComponentUpdate(a=!1){return i(this,a,this.props,this.states)}}return{Component:r,render:function(a,b){return h(f(a),b)},elementReady:function(a,b){k(a,b)},createElement:c,createFactory:function(a){return function(b={}){return c(a,b)}}}});
